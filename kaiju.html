<html>
<head>
    <title>肉鸽开局生成器</title>
    <style>
        body {
            padding-top: 10px;
            padding-left: 10px;
            padding-right: 10px;
            color: #FFF;
            text-shadow: -2px -2px #000, -2px -1px #000, -2px 0 #000, -2px 1px #000, -2px 2px #000, -1px -2px #000, -1px -1px #000, -1px 0 #000, -1px 1px #000, -1px 2px #000, 0 -2px #000, 0 -1px #000, 0 0 #000, 0 1px #000, 0 2px #000, 1px -2px #000, 1px -1px #000, 1px 0 #000, 1px 1px #000, 1px 2px #000, 2px -2px #000, 2px -1px #000, 2px 0 #000, 2px 1px #000, 2px 2px #000;
            text-align: center;
        }

        a:link, a:visited {
            color: #FFA500;
        }

        textarea {
            width: 100%;
            resize: none;
        }

        table {
            border-collapse: collapse;
        }

        .table_text {
            width: 100%;
            text-align: left;
            table-layout: fixed;
        }

        .table_text tr {
            height: 90px;
        }

        .table_text th {
            font-size: 2em;
            padding: 10px;
        }

        .table_text td {
            height: 90px;
            width: 50%;
            font-size: 1.5em;
        }

        th input {
            width: 80%;
            font-size: 1.5em
        }

        td[id^="td_box"] span {
            display: inline-block;
            margin-right: 20px;
        }

        .div_button {
            background-color: #F0F0F07F;
            padding: 10px;
            border-radius: 3px;
            border-color: #000;
            border-style: solid;
            border-width: 1px;
            text-align: center;
        }

        .div_button:hover, .div_button_settings:hover {
            background-color: #2B666666;
        }

        #tr_notice {
            background-color: #ffbf92;
        }

        #td_notice {
            width: 80%;
            padding-left: 10px;
        }

        #td_notice_button {
            width: 20%;
            padding-right: 10px;
            text-align: right;
        }

        .div_notice_button {
            width: 50px;
            display: inline-block;
            background-color: #F0F0F07F;
            padding: 10px;
            border-radius: 3px;
            border-color: #000;
            border-style: solid;
            border-width: 1px;
            text-align: center;
        }

        .div_button_tag, .div_button_settings {
            width: 150px;
            display: inline-block;
            background-color: #F0F0F07F;
            padding: 10px;
            border-radius: 3px;
            border-color: #000;
            border-style: solid;
            border-width: 1px;
            text-align: center;
        }

        .div_button_tag:hover {
            outline-color: #00AAFF;
            outline-style: solid;
            outline-width: 3px;
        }

        .div_button_tag_enabled {
            background-color: #00AAFF;
        }

        .div_button_tag_enabled_useless {
            background-color: #bb5a5a;
        }

        .div_button_tag_disabled {
            background-color: #ebeb16;
        }

        .div_button_tag_disabled_useless {
            background-color: #76cb8b;
        }
    </style>
    <link rel="icon" href="./favicon.ico">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QGM58QCD7C"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-QGM58QCD7C');
    </script>
    <script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>
</head>

<body>
    <table class="table_text">
        <tr>
            <td>
                <div class="div_button" id="div_button_settings_main" onclick="handle_button_settings();">设置</div>
            </td>
            <td>
                <div class="div_button" onclick="location.reload();">清空（刷新）</div>
            </td>
        </tr>
    </table>
    <table class="table_text" id="table_settings" onclick="save_settings();" style="display: none;">
        <tr style="display: none;">
            <td colspan="2">
                <div class="div_button_settings" onclick="handle_notice(101);">使用默认设置</div>
                <div class="div_button_settings" onclick="handle_notice(102);">恢复之前设置</div>
            </td>
        </tr>
        <tr>
            <td>
                集成战略：
            </td>
            <td>
                <input id="is_4" type="checkbox" checked><label for="is_4">探索者的银凇止境</label>
            </td>
            <td>
                <input id="is_3" type="checkbox"><label for="is_3">水月与深蓝之树</label>
            </td>
            <td>
                <input id="is_2" type="checkbox"><label for="is_2">傀影与猩红孤钻</label>
            </td>
        </tr>
        <tr>
            <td>
                仅使用职业分队开局
            </td>
            <td>
                <input id="job_group_only" type="checkbox"><label for="job_group_only">开启</label>
            </td>
        </tr>
        <tr>
            <td>
                <div class="div_button_settings" id="div_button_settings_box" onclick="handle_box_settings();">自定义box</div>
            </td>
        </tr>
    </table>
    <table class="table_text" id="table_box" onclick="save_settings();" style="display: none; table-layout: auto; border: 1px solid #ccc;">
        <tr><th style="width: 80px;">先锋</th><td style="width: auto;" id="td_box_operators_star_6_先锋"></td></tr>
        <tr><th style="width: 80px;">近卫</th><td style="width: auto;" id="td_box_operators_star_6_近卫"></td></tr>
        <tr><th style="width: 80px;">重装</th><td style="width: auto;" id="td_box_operators_star_6_重装"></td></tr>
        <tr><th style="width: 80px;">狙击</th><td style="width: auto;" id="td_box_operators_star_6_狙击"></td></tr>
        <tr><th style="width: 80px;">术师</th><td style="width: auto;" id="td_box_operators_star_6_术师"></td></tr>
        <tr><th style="width: 80px;">医疗</th><td style="width: auto;" id="td_box_operators_star_6_医疗"></td></tr>
        <tr><th style="width: 80px;">辅助</th><td style="width: auto;" id="td_box_operators_star_6_辅助"></td></tr>
        <tr><th style="width: 80px;">特种</th><td style="width: auto;" id="td_box_operators_star_6_特种"></td></tr>
    </table>
    <table class="table_text">
        <tr id="tr_notice">
            <td id="td_notice">
                <h3>最近更新：</h3>
                <p>加入自定义box设置</p>
                <p>加入自动保存设置功能</p>
                <p>加入仅使用职业分队开局选项</p>
                <p>加入<span style="color: #dd9090;">今日剧本！</span></p>
            </td>
            <td id="td_notice_button">
                <div class="div_notice_button" onclick="handle_notice(1);">好的</div>
            </td>
        </tr>
    </table>
    <table class="table_text" id="table_main">
        <tr>
            <td colspan="2" id="td_notice_2">
                <span style="color:#ebeb16"></span>
            </td>
        </tr>
        <tr>
            <th colspan="1">我是 <input type="text" id="user_id" onkeypress="handle_input_keypress(event);"></th>
            <th colspan="1"><div class="div_button" onclick="reset_opening_today_4();">重置</div></th>
        </tr>
        <tr id="tr_today_button">
            <th colspan="2"><div class="div_button" onclick="get_opening_today_4();">今日开局！</div></th>
        </tr>
        <tr id="tr_today_result" style="display: none;">
            <td colspan="2" id="td_today"></td>
        </tr>
        <tr id="tr_drama_button">
            <th colspan="1" style="color: #ffbf92;"><div class="div_button" onclick="get_drama_today_4(1);">今日剧本！</div></th>
            <th colspan="1" style="color: #dd9090;"><div class="div_button" onclick="get_drama_today_4(2);">今日剧本+！</div></th>
        </tr>
        <tr id="tr_drama_result" style="display: none;">
            <td colspan="2" id="td_drama"></td>
        </tr>
        <tr>
            <th colspan="2"><div class="div_button" onclick="get_opening_random_4();">随机开局！</div></th>
        </tr>
        <tr>
            <td colspan="2" id="td_random"></td>
        </tr>
    </table>

    <script>
        const question_mark = '？';
        const window_length = 10;

        const IS = [
            '傀影与猩红孤钻',
            '水月与深蓝之树',
            '探索者的银凇止境',
        ]

        const GROUPS_2 = [
            '指挥分队', '集群分队', '后勤分队', '矛头分队',
            '突击战术分队', '堡垒战术分队', '远程战术分队', '破坏战术分队',
            '研究分队', '高规格分队',
        ]
        const GROUPS_3 = [
            '心胜于物分队', '物尽其用分队', '以人为本分队',
            '指挥分队', '集群分队', '后勤分队', '矛头分队',
            '突击战术分队', '堡垒战术分队', '远程战术分队', '破坏战术分队',
            '研究分队', '高规格分队',
        ]
        const GROUPS_4 = [
            '指挥分队', '集群分队', '后勤分队', '矛头分队',
            '突击战术分队', '堡垒战术分队', '远程战术分队', '破坏战术分队',
            '特训分队', '高规格分队',
            '永恒狩猎分队', '生活至上分队', '科学主义分队'
        ]
        const GROUPS_JOBS = ['突击战术分队', '堡垒战术分队', '远程战术分队', '破坏战术分队']
        const OPERATORS_STAR_6_VANGUARD = ['推进之王', '风笛', '嵯峨', '琴柳', '焰尾', '伺夜', '伊内丝', '缪尔赛思']
        const OPERATORS_STAR_6_GUARD = ['银灰', '斯卡蒂', '陈', '赫拉格', '煌', '棘刺', '史尔特尔', '山', '帕拉斯', '耀骑士临光', '艾丽妮', '百炼嘉维尔', '玛恩纳', '重岳', '仇白', '圣约送葬人', '赫德雷']
        const OPERATORS_STAR_6_DEFENDER = ['星熊', '塞雷娅', '年', '森蚺', '瑕光', '泥岩', '号角', '斥罪', '涤火杰西卡']
        const OPERATORS_STAR_6_SNIPER = ['能天使', '黑', 'W', '早露', '迷迭香', '空弦', '灰烬', '假日威龙陈', '远牙', '菲亚梅塔', '鸿雪', '提丰']
        const OPERATORS_STAR_6_CASTER = ['伊芙利特', '艾雅法拉', '莫斯提马', '刻俄柏', '夕', '异客', '卡涅利安', '澄闪', '黑键', '林', '霍尔海雅']
        const OPERATORS_STAR_6_MEDIC = ['闪灵', '夜莺', '凯尔希', '流明', '焰影苇草', '纯烬艾雅法拉']
        const OPERATORS_STAR_6_SUPPORTER = ['安洁莉娜', '麦哲伦', '铃兰', '浊心斯卡蒂', '灵知', '令', '白铁', '淬羽赫默']
        const OPERATORS_STAR_6_SPECIALIST = ['阿', '傀影', '温蒂', '歌蕾蒂娅', '水月', '老鲤', '归溟幽灵鲨', '多萝西', '缄默德克萨斯', '麒麟R夜刀', '琳琅诗怀雅']
        const OPERATORS_STAR_6_ALL = OPERATORS_STAR_6_VANGUARD.concat(OPERATORS_STAR_6_GUARD).concat(OPERATORS_STAR_6_DEFENDER).concat(OPERATORS_STAR_6_SNIPER).concat(OPERATORS_STAR_6_CASTER).concat(OPERATORS_STAR_6_MEDIC).concat(OPERATORS_STAR_6_SUPPORTER).concat(OPERATORS_STAR_6_SPECIALIST)
        const OPERATORS_STAR_6 = {
            '先锋': OPERATORS_STAR_6_VANGUARD,
            '近卫': OPERATORS_STAR_6_GUARD,
            '重装': OPERATORS_STAR_6_DEFENDER,
            '狙击': OPERATORS_STAR_6_SNIPER,
            '术师': OPERATORS_STAR_6_CASTER,
            '医疗': OPERATORS_STAR_6_MEDIC,
            '辅助': OPERATORS_STAR_6_SUPPORTER,
            '特种': OPERATORS_STAR_6_SPECIALIST
        }

        const OPERATORS_STAR_5_VANGUARD = ['凛冬', '德克萨斯', '格拉尼', '苇草', '极境', '贾维', '野鬃', '夜半', '晓歌', '谜图', '青枳']
        const OPERATORS_STAR_5_GUARD = ['芙兰卡', '因陀罗', '拉普兰德', '幽灵鲨', '暴行', '诗怀雅', '星极', '炎客', '布洛卡', '柏喙', '铸铁', '断崖', '燧石', '鞭刃', '阿米娅(近卫)',
            '战车', '赤冬', '龙舌兰', '羽毛笔', '海沫', '达格达', '铎铃', '火龙S黑角', '摩根', '苍苔']
        const OPERATORS_STAR_5_DEFENDER = ['临光', '雷蛇', '可颂', '火神', '拜松', '吽', '石棉', '闪击', '暴雨', '灰毫', '极光', '暮落', '车尔尼', '火哨', '洋灰']
        const OPERATORS_STAR_5_SNIPER = ['蓝毒', '白金', '陨星', '普罗旺斯', '守林人', '送葬人', '灰喉', '慑砂', '安哲拉', '四月', '奥斯塔', '熔泉', '寒芒克洛丝', '埃拉托', '承曦格雷伊', '子月', '截云', '玫拉', '隐现', '冰酿']
        const OPERATORS_STAR_5_CASTER = ['阿米娅', '天火', '夜魔', '惊蛰', '苦艾', '莱恩哈特', '蜜蜡', '特米米', '薄绿', '爱丽丝', '炎狱炎熔', '蚀清', '耶拉', '洛洛', '星源', '至简', '雪绒', '和弦', '寒檀', '戴菲恩']
        const OPERATORS_STAR_5_MEDIC = ['白面鸮', '赫默', '华法琳', '锡兰', '微风', '亚叶', '絮雨', '图耶', '桑葚', '蜜莓', '濯尘芙蓉', '明椒', '刺玫']
        const OPERATORS_STAR_5_SUPPORTER = ['梅尔', '初雪', '真理', '空', '格劳克斯', '巫恋', '月禾', '稀音', '九色鹿', '夏栎', '海蒂', '掠风', '但书', '凛视']
        const OPERATORS_STAR_5_SPECIALIST = ['红', '崖心', '狮蝎', '食铁兽', '槐琥', '雪雉', '罗宾', '卡夫卡', '乌有', '霜华', '贝娜', '绮良', '见行者', '风丸', '空构', '杏仁']
        const OPERATORS_STAR_5_ALL = OPERATORS_STAR_5_VANGUARD.concat(OPERATORS_STAR_5_DEFENDER).concat(OPERATORS_STAR_5_SNIPER).concat(OPERATORS_STAR_5_CASTER).concat(OPERATORS_STAR_5_MEDIC).concat(OPERATORS_STAR_5_SUPPORTER).concat(OPERATORS_STAR_5_SPECIALIST)

        let weight_star_5 = 1;
        let weight_star_6 = 2;

        let current_operators_6_all, current_operators_6;

        function save_settings() {
            if (!window.localStorage) {
                console.error("浏览器不支持localStorage");
            }
            else {
                console.log("save_settings()");
                let storage = window.localStorage;
                // 选中的集成战略
                let enabled_is = [];
                if (document.getElementById('is_2').checked) {
                    enabled_is.push(2)
                }
                if (document.getElementById('is_3').checked) {
                    enabled_is.push(3)
                }
                if (document.getElementById('is_4').checked) {
                    enabled_is.push(4)
                }
                // 不在box中的干员
                let operators_star_6_to_get = [];
                for (let idx = 0; idx < OPERATORS_STAR_6_ALL.length; idx++) {
                    let code_name = OPERATORS_STAR_6_ALL[idx];
                    if (document.getElementById(code_name).checked == false) {
                        operators_star_6_to_get.push(code_name);
                    }
                }
                let data_to_save = {
                    'enabled_is': enabled_is,
                    'job_group_only': document.getElementById('job_group_only').checked,
                    'to_get': operators_star_6_to_get,
                };
                storage['data_ji_kaiju'] = JSON.stringify(data_to_save);
                return true;
            }
        }

        function load_settings() {
            if (!window.localStorage) {
                console.error("浏览器不支持localStorage");
            }
            else {
                console.log("load_settings()");
                if (!window.localStorage['data_ji_kaiju']) {
                    console.log("没有找到已保存的设置");
                    return false;
                }
                let data = JSON.parse(window.localStorage['data_ji_kaiju']);
                // 选中的集成战略
                document.getElementById('is_2').checked = data['enabled_is'].includes(2);
                document.getElementById('is_3').checked = data['enabled_is'].includes(3);
                document.getElementById('is_4').checked = data['enabled_is'].includes(4);
                // 仅使用职业分队开局
                document.getElementById('job_group_only').checked = data['job_group_only'];
                // 不在box中的干员
                current_operators_6 = JSON.parse(JSON.stringify(OPERATORS_STAR_6));
                current_operators_6_all = OPERATORS_STAR_6_ALL.slice();
                for (let job in OPERATORS_STAR_6) {
                    for (let idx = 0; idx < OPERATORS_STAR_6[job].length; idx++) {
                        let code_name = OPERATORS_STAR_6[job][idx];
                        if (data['to_get'].includes(code_name)) {
                            document.getElementById(code_name).checked = false;
                            current_operators_6_all.splice(current_operators_6_all.indexOf(code_name), 1);
                            current_operators_6[job].splice(current_operators_6[job].indexOf(code_name), 1);
                        }
                    }
                }
                return true;
            }
        }

        function init_table_box() {
            for (let job in OPERATORS_STAR_6) {
                for (let idx = 0; idx < OPERATORS_STAR_6[job].length; idx++) {
                    let code_name = OPERATORS_STAR_6[job][idx];
                    document.getElementById(`td_box_operators_star_6_${job}`).innerHTML += `
                        <span><input type="checkbox" id="${code_name}" checked><label for="${code_name}">${code_name}</label></span>
                    `
                }
            }
        }

        function update_current_operators() {
            current_operators_6 = JSON.parse(JSON.stringify(OPERATORS_STAR_6));
            current_operators_6_all = OPERATORS_STAR_6_ALL.slice();
            for (let job in OPERATORS_STAR_6) {
                for (let idx = 0; idx < OPERATORS_STAR_6[job].length; idx++) {
                    let code_name = OPERATORS_STAR_6[job][idx];
                    if (document.getElementById(code_name).checked == false) {
                        current_operators_6_all.splice(current_operators_6_all.indexOf(code_name), 1);
                        current_operators_6[job].splice(current_operators_6[job].indexOf(code_name), 1);
                    }
                }
            }
        }

        function get_opening_today_4() {
            update_current_operators();
            let user_id = document.getElementById('user_id').value;
            let now = (new Date).toLocaleDateString("zh-CN");
            let hash_int = parseInt(md5(user_id.concat('_').concat(now)).slice(0, 8), 16) % (GROUPS_4.length * current_operators_6_all.length);

            let is_pool = [];
            if (document.getElementById('is_2').checked) {
                is_pool.push('傀影与猩红孤钻')
            }
            if (document.getElementById('is_3').checked) {
                is_pool.push('水月与深蓝之树')
            }
            if (document.getElementById('is_4').checked) {
                is_pool.push('探索者的银凇止境')
            }
            let opening_is = is_pool[hash_int % is_pool.length];
            let opening_group;
            if (document.getElementById('job_group_only').checked) {
                opening_group = GROUPS_JOBS[hash_int % GROUPS_JOBS.length];
            }
            else {
                if (opening_is == '傀影与猩红孤钻') {
                    opening_group = GROUPS_2[hash_int % GROUPS_2.length];
                }
                if (opening_is == '水月与深蓝之树') {
                    opening_group = GROUPS_3[hash_int % GROUPS_3.length];
                }
                if (opening_is == '探索者的银凇止境') {
                    opening_group = GROUPS_4[hash_int % GROUPS_4.length];
                }
            }
            let operators;
            if (opening_group == '突击战术分队') {
                operators = current_operators_6['先锋'].concat(current_operators_6['近卫']);
            }
            else if (opening_group == '堡垒战术分队') {
                operators = current_operators_6['重装'].concat(current_operators_6['辅助']);
            }
            else if (opening_group == '远程战术分队') {
                operators = current_operators_6['狙击'].concat(current_operators_6['医疗']);
            }
            else if (opening_group == '破坏战术分队') {
                operators = current_operators_6['术师'].concat(current_operators_6['特种']);
            }
            else {
                operators = current_operators_6_all;
            }
            let opening_operator = operators[hash_int % operators.length];
            let result = `我掐指一算，今天 ${user_id} 适合在 ${opening_is} 用 ${opening_group} ${opening_operator} 开局`;
            document.getElementById('tr_today_button').style.display = 'none';
            document.getElementById('tr_today_result').style.display = '';
            handle_text_animation('td_today', result);
        }

        function get_drama_today_4(level=1) {
            update_current_operators();
            let drama_level, replys = [];
            let user_id = document.getElementById('user_id').value;
            let now = (new Date).toLocaleDateString("zh-CN");
            let hash_int = parseInt(md5(user_id.concat('_').concat(now)).slice(0, 8), 16) % (GROUPS_4.length * current_operators_6_all.length);

            let is_pool = [];
            if (document.getElementById('is_2').checked) {
                is_pool.push('傀影与猩红孤钻')
            }
            if (document.getElementById('is_3').checked) {
                is_pool.push('水月与深蓝之树')
            }
            if (document.getElementById('is_4').checked) {
                is_pool.push('探索者的银凇止境')
            }
            let opening_is = is_pool[hash_int % is_pool.length];
            let opening_group;
            if (document.getElementById('job_group_only').checked) {
                opening_group = GROUPS_JOBS[hash_int % GROUPS_JOBS.length];
            }
            else {
                if (opening_is == '傀影与猩红孤钻') {
                    opening_group = GROUPS_2[hash_int % GROUPS_2.length];
                }
                if (opening_is == '水月与深蓝之树') {
                    opening_group = GROUPS_3[hash_int % GROUPS_3.length];
                }
                if (opening_is == '探索者的银凇止境') {
                    opening_group = GROUPS_4[hash_int % GROUPS_4.length];
                }
            }
            let operators;
            if (opening_group == '突击战术分队') {
                operators = current_operators_6['先锋'].concat(current_operators_6['近卫']);
            }
            else if (opening_group == '堡垒战术分队') {
                operators = current_operators_6['重装'].concat(current_operators_6['辅助']);
            }
            else if (opening_group == '远程战术分队') {
                operators = current_operators_6['狙击'].concat(current_operators_6['医疗']);
            }
            else if (opening_group == '破坏战术分队') {
                operators = current_operators_6['术师'].concat(current_operators_6['特种']);
            }
            else {
                operators = current_operators_6_all.slice();
            }
            let opening_operator = operators[hash_int % operators.length];
            replys.push(`我掐指一算，今天 ${user_id} 适合在 ${opening_is} 用 ${opening_group} ${opening_operator} 开局`);

            let user_box = JSON.parse(JSON.stringify(current_operators_6));
            let tefuda = {
                '先锋': 0,
                '近卫': 0,
                '重装': 0,
                '狙击': 0,
                '术师': 0,
                '医疗': 0,
                '辅助': 0,
                '特种': 0,
            }
            operators = current_operators_6_all.slice();
            operators.splice(operators.indexOf(opening_operator), 1);
            for (let job in user_box) {
                if (user_box[job].includes(opening_operator)) {
                    tefuda[job] += 1
                    user_box[job].splice(user_box[job].indexOf(opening_operator), 1);
                    break;
                }
            }
            switch (level) {
                case 1:
                    drama_level = 7;
                    // replys.push(`指定的强度为${level}`);
                    break;
                case 2:
                    drama_level = 15;
                    // replys.push(`指定的强度为${level}`);
                    break;
                default:
                    drama_level = 7;
                    // replys.push(`使用默认强度${drama_level}`);
            }
            // 禁用
            let banned_operators = []
            for (let i = 0; i <= drama_level; i++) {
                let banned_operator = operators[hash_int % operators.length];
                banned_operators.push(banned_operator);
                operators.splice(operators.indexOf(banned_operator), 1);
                for (let job in user_box) {
                    if (user_box[job].includes(banned_operator)) {
                        user_box[job].splice(user_box[job].indexOf(banned_operator), 1);
                        break;
                    }
                }
            }
            replys.push(`将以下 ${banned_operators.length} 位干员从本局游戏中移除：${banned_operators.join('、')}`);
            // 处理某一职业刚好全被禁用的情况
            let keys = Object.keys(user_box);
            for (let i = 0; i < keys.length; i++) {
                let job = keys[i];
                if (user_box[job].length == 0) {
                    delete user_box[job];
                    delete tefuda[job];
                }
            }

            // 选择
            for (let i = 0; i < drama_level; i++) {
                let jobs = [];
                for (let j in tefuda) {
                    if (tefuda[j] < Math.max(...Object.values(tefuda))) {
                        jobs.push(j);
                    }
                }
                if (jobs.length == 0) {
                    jobs = Object.keys(tefuda);
                }
                let job_id = hash_int % jobs.length;
                let job = jobs[job_id];
                operator = user_box[job].splice(hash_int % user_box[job].length, 1)
                tefuda[job] += 1
                replys.push(`<input type="checkbox" id="operator_pick_${i}"><label for="operator_pick_${i}">第 ${tefuda[job]} 位 六星${job}干员 选择 ${operator}</label>`)
                if (user_box[job].length == 0) {
                    delete user_box[job];
                    delete tefuda[job];
                }
            }
            document.getElementById('tr_today_button').style.display = 'none';
            document.getElementById('tr_today_result').style.display = 'none';
            document.getElementById('tr_drama_button').style.display = 'none';
            document.getElementById('tr_drama_result').style.display = '';
            document.getElementById('td_drama').innerHTML = replys.join('<br>');
        }

        function get_opening_random_4() {
            let operators_star_5 = OPERATORS_STAR_5_ALL.slice();
            let operators_star_6 = OPERATORS_STAR_6_ALL.slice();
            let opening_group = GROUPS_4[Math.floor(Math.random() * GROUPS_4.length)];
            if (opening_group == '突击战术分队') {
                operators_star_6 = OPERATORS_STAR_6_VANGUARD.concat(OPERATORS_STAR_6_GUARD);
                operators_star_5 = OPERATORS_STAR_5_VANGUARD.concat(OPERATORS_STAR_5_GUARD);
            }
            else if (opening_group == '堡垒战术分队') {
                operators_star_6 = OPERATORS_STAR_6_DEFENDER.concat(OPERATORS_STAR_6_SUPPORTER);
                operators_star_5 = OPERATORS_STAR_5_DEFENDER.concat(OPERATORS_STAR_5_SUPPORTER);
            }
            else if (opening_group == '远程战术分队') {
                operators_star_6 = OPERATORS_STAR_6_SNIPER.concat(OPERATORS_STAR_6_MEDIC);
                operators_star_5 = OPERATORS_STAR_5_SNIPER.concat(OPERATORS_STAR_5_MEDIC);
            }
            else if (opening_group == '破坏战术分队') {
                operators_star_6 = OPERATORS_STAR_6_CASTER.concat(OPERATORS_STAR_6_SPECIALIST);
                operators_star_5 = OPERATORS_STAR_5_CASTER.concat(OPERATORS_STAR_5_SPECIALIST);
            }
            let opening_operator;
            if (Math.random() * (weight_star_5 + weight_star_6) <= weight_star_6) {
                opening_operator = operators_star_6[Math.floor(Math.random() * operators_star_6.length)];
            }
            else {
                opening_operator = operators_star_5[Math.floor(Math.random() * operators_star_5.length)];
            }
            let result = `用 ${opening_group} ${opening_operator} 开局吧！`;
            handle_text_animation('td_random', result);
        }

        function handle_text_animation(element, full_text) {
            let block_text = question_mark.repeat(window_length);
            document.getElementById(element).innerHTML = '';
            for (let k = 1; k <= full_text.length; k++) {
                setTimeout(() => {
                    let temp_text = full_text.slice(0, k);
                    if (k < window_length) {
                        temp_text = temp_text + block_text;
                        temp_text = temp_text.slice(0, window_length);
                    }
                    document.getElementById(element).innerHTML = temp_text;
                }, k * 1000 / full_text.length);
            }
        }

        function handle_input_keypress(event) {
            let keyCode;
            if (event.which) {
                keyCode = event.which;
            }
            else if (e.keyCode) {
                keyCode = event.keyCode;
            }
            if (keyCode == 13) {
                get_opening_today_4();
            }
        }

        function handle_notice(code) {
            let storage = window.localStorage;
            if (code == 1) {
                // 保存最近确认过的提示
                storage['data_ji_kaiju_last_checked_notice'] = document.getElementById('td_notice').innerHTML.trim();
            }
            // 比较最近确认过的提示
            if (storage['data_ji_kaiju_last_checked_notice'] == document.getElementById('td_notice').innerHTML.trim()) {
                // 一致时隐藏提示
                document.getElementById('tr_notice').style.display = 'none';
            }
        }

        function handle_button_settings() {
            if (document.getElementById('table_settings').style.display == 'none') {
                document.getElementById('table_settings').style.display = '';
                document.getElementById('div_button_settings_main').innerHTML = "收起设置";
            }
            else {
                // if (save_settings()) {
                if (true) {
                    document.getElementById('table_settings').style.display = 'none';
                    document.getElementById('div_button_settings_main').innerHTML = '设置';
                    document.getElementById('table_box').style.display = 'none';
                    document.getElementById('div_button_settings_box').innerHTML = '自定义box';
                };
            }
        }

        function handle_box_settings() {
            if (document.getElementById('table_box').style.display == 'none') {
                document.getElementById('table_box').style.display = '';
                document.getElementById('div_button_settings_box').innerHTML = "收起box";
            }
            else {
                document.getElementById('table_box').style.display = 'none';
                document.getElementById('div_button_settings_box').innerHTML = '自定义box';
            }
        }

        function reset_opening_today_4() {
            document.getElementById('user_id').value = ''
            document.getElementById('tr_today_button').style.display = '';
            document.getElementById('tr_today_result').style.display = 'none';
            document.getElementById('tr_drama_button').style.display = '';
            document.getElementById('tr_drama_result').style.display = 'none';
        }



        // 页面加载完成时执行
        init_table_box();
        load_settings();
        update_current_operators();
        handle_notice();
    </script>
</body>
</html>